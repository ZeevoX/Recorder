import java.text.SimpleDateFormat

apply plugin: 'com.android.application'

/*ext {
    versionMajor = 1
    versionMinor = 0
    versionPatch = 0
}

static def buildNumber() {
    return "${versionMajor}.${versionMinor}.${versionPatch}"
}*/

static def buildDate() {
    def df = new SimpleDateFormat("yyyyMMdd")
    String formatted = df.format(new Date())
    return formatted
}

static def gitVersionCode() {
    def process = "git rev-list master --first-parent --count".execute()
    return process.text.toInteger()
}

static def gitVersionName() {
    def process = "git describe --tags --dirty=debug".execute()
    //return process.text
    return process.text.replaceAll('-', '\\.')
}

android {

    signingConfigs {
        config {
            storeFile file("gitlab_keystore.jks")
            storePassword "recorder"
            keyAlias "Gitlab-PublicKey"
            keyPassword "recorder"
        }
    }

    lintOptions {
        checkReleaseBuilds false
        abortOnError false
    }

    compileSdkVersion 25
    buildToolsVersion "25.0.3"

    defaultConfig {

        buildConfigField "long", "TIMESTAMP", System.currentTimeMillis() + "L"
        //project.ext.set("archivesBaseName", "recorder2")
        applicationId "com.zeevox.recorder2"

        minSdkVersion 23
        targetSdkVersion 25

        //versionCode Integer.parseInt(buildDate())
        //versionName buildNumber()
        versionCode gitVersionCode()
        versionName gitVersionName()

        /*applicationVariants.all { variant ->
            variant.outputs.each { output ->
                def file = output.outputFile
                def fileName = file.name.replace("recorder2", "recorder2_" + buildNumber())
                output.outputFile = new File(file.parentFile, fileName)
            }
        }*/
    }

    buildTypes {

        debug {
            debuggable true
            jniDebuggable true
            renderscriptDebuggable true
            minifyEnabled false
            shrinkResources false
            zipAlignEnabled false

            //versionNameSuffix '.debug_' + buildDate()
        }

        weekly {
            debuggable false
            jniDebuggable false
            renderscriptDebuggable false
            minifyEnabled true
            shrinkResources true
            zipAlignEnabled true
            signingConfig signingConfigs.config

            versionNameSuffix '.weekly_' + buildDate()
        }

        beta {

            debuggable false
            jniDebuggable false
            renderscriptDebuggable false
            minifyEnabled true
            shrinkResources true
            zipAlignEnabled true

            versionNameSuffix '.beta'
        }

        release {
            debuggable false
            jniDebuggable false
            renderscriptDebuggable false
            minifyEnabled true
            shrinkResources true
            zipAlignEnabled true
        }
    }
}

dependencies {
    compile fileTree(include: ['*.jar'], dir: 'libs')
    compile 'com.android.support:appcompat-v7:25.3.1'
    compile 'com.android.support:design:25.3.1'

    /*               FABToolbar by fafaldo              */
    /*       https://github.com/fafaldo/FABToolbar      */
    //compile 'com.github.fafaldo:fab-toolbar:1.2.0'

    /*          Material Dialogs by afollestad          */
    /*  https://github.com/afollestad/material-dialogs  */
    //compile 'com.afollestad.material-dialogs:core:0.9.4.5'
    //compile 'com.afollestad.material-dialogs:commons:0.9.4.5'

    /*               LicensesDialog by PSDev            */
    /*     https://github.com/PSDev/LicensesDialog      */
    compile('de.psdev.licensesdialog:licensesdialog:1.8.2')
}
